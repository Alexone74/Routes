<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Percorsi Milano - Visualizza i percorsi stradali di Milano">
  <title>Percorsi Milano</title>
  
  <!-- Favicon -->
  <link rel="icon" href="favicon.ico" />
  
  <!-- Font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- React e ReactDOM -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  
  <!-- Babel per JSX - √à importante usare la versione 7 o superiore -->
  <script src="https://unpkg.com/@babel/standalone@7.21.4/babel.min.js"></script>
  
  <style>
    body {
      font-family: 'Inter', sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f3f4f6;
      min-height: 100vh;
    }
    #root {
      min-height: 100vh;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <!-- Script principale dell'app -->
  <script type="text/babel" data-type="module">
    function App() {
      // Categorie di partenza
      var categorie = [
        'Aeroporti',
        'Ospedali',
        'Piazze',
        'Cerchie',
        'Stazioni',
        'Autostrade',
        'Duomo'
      ];
    
      // Stato per memorizzare i percorsi
      var [percorsiDB, setPrecorsiDB] = React.useState({});
      var [caricamento, setCaricamento] = React.useState(true);
      var [erroreCaricamento, setErroreCaricamento] = React.useState(null);
      
      // Stati dell'applicazione
      var [step, setStep] = React.useState('categorie'); // 'categorie', 'percorsi', 'vie', 'ricerca'
      var [categoriaSelezionata, setCategoriaSelezionata] = React.useState(null);
      var [percorsoSelezionato, setPercorsoSelezionato] = React.useState(null);
      var [viaCorrente, setViaCorrente] = React.useState(0);
      var [testoRicerca, setTestoRicerca] = React.useState('');
      
      // Effetto per caricare i dati dal file JSON all'avvio dell'app
      React.useEffect(function() {
        // Funzione per caricare i dati
        async function caricaDati() {
          try {
            setCaricamento(true);
            
            // Carica il file JSON dalla stessa cartella dell'index.html
            var risposta = await fetch('percorsi.json');
            
            // Controlla se la richiesta ha avuto successo
            if (!risposta.ok) {
              throw new Error('Errore di rete: ' + risposta.status);
            }
            
            // Converte la risposta in JSON
            var dati = await risposta.json();
            
            // Salva i dati nello stato
            setPrecorsiDB(dati);
            setCaricamento(false);
          } catch (errore) {
            console.error('Errore durante il caricamento dei percorsi:', errore);
            setErroreCaricamento(errore.message);
            setCaricamento(false);
          }
        }
        
        // Chiama la funzione di caricamento
        caricaDati();
      }, []);
      
      // Funzione per selezionare una categoria
      function selezionaCategoria(categoria) {
        setCategoriaSelezionata(categoria);
        setStep('percorsi');
      }
    
      // Funzione per selezionare un percorso
      function selezionaPercorso(percorso) {
        setPercorsoSelezionato(percorso);
        setViaCorrente(0);
        setStep('vie');
      }
    
      // Funzione per visualizzare la via successiva
      function mostraViaSuccessiva() {
        if (viaCorrente < percorsoSelezionato.vie.length - 1) {
          setViaCorrente(viaCorrente + 1);
        }
      }
    
      // Funzione per visualizzare la via precedente
      function mostraViaPrecedente() {
        if (viaCorrente > 0) {
          setViaCorrente(viaCorrente - 1);
        }
      }
    
      // Funzione per tornare al passo precedente
      function tornaDietro() {
        if (step === 'vie') {
          setStep('percorsi');
        } else if (step === 'percorsi') {
          setStep('categorie');
          setCategoriaSelezionata(null);
        } else if (step === 'ricerca') {
          setStep('categorie');
          setTestoRicerca('');
        }
      }
      
      // Funzione per cercare percorsi
      function cercaPercorsi() {
        if (!testoRicerca.trim()) return [];
        
        var risultati = [];
        var query = testoRicerca.toLowerCase();
        
        Object.keys(percorsiDB).forEach(function(categoria) {
          percorsiDB[categoria].forEach(function(percorso) {
            // Cerca nella partenza e destinazione
            if (percorso.nome.toLowerCase().includes(query)) {
              risultati.push({...percorso, categoria});
              return;
            }
            
            // Cerca nelle vie
            var trovatoInVie = percorso.vie.some(function(via) {
              return via.toLowerCase().includes(query);
            });
            
            if (trovatoInVie) {
              risultati.push({...percorso, categoria});
            }
          });
        });
        
        return risultati;
      }
      
      // Funzione per contare i percorsi totali
      function contaPercorsiTotali() {
        if (!percorsiDB || Object.keys(percorsiDB).length === 0) return 0;
        
        var totale = 0;
        Object.values(percorsiDB).forEach(function(percorsiCategoria) {
          totale += percorsiCategoria.length;
        });
        
        return totale;
      }
    
      return (
        <div className="flex flex-col min-h-screen bg-gray-100">
          <header className="bg-blue-600 text-white p-4 shadow-md">
            <div className="container mx-auto flex justify-between items-center">
              <div className="flex items-center space-x-4">
                <h1 className="text-2xl font-bold">Percorsi Milano</h1>
                {!caricamento && !erroreCaricamento && step !== 'categorie' && (
                  <button 
                    onClick={function() {
                      setStep('categorie');
                      setCategoriaSelezionata(null);
                      setPercorsoSelezionato(null);
                    }}
                    className="bg-blue-500 hover:bg-blue-400 text-white px-3 py-1 rounded-lg border border-white"
                  >
                    <span className="flex items-center">
                      üè† Home
                    </span>
                  </button>
                )}
              </div>
              {!caricamento && !erroreCaricamento && (
                <button 
                  onClick={function() { setStep('ricerca'); }}
                  className="bg-white text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-50 font-medium"
                >
                  <span className="flex items-center">
                    üîç Cerca
                  </span>
                </button>
              )}
            </div>
          </header>
          
          <main className="flex flex-col flex-grow p-4 md:p-6">
            {/* Schermata di caricamento */}
            {caricamento && (
              <div className="flex-grow flex flex-col items-center justify-center">
                <div className="text-xl font-semibold text-gray-700 mb-4">Caricamento percorsi...</div>
                <div className="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin"></div>
              </div>
            )}
            
            {/* Errore di caricamento */}
            {erroreCaricamento && (
              <div className="flex-grow flex flex-col items-center justify-center">
                <div className="text-xl font-semibold text-red-600 mb-2">Errore durante il caricamento</div>
                <div className="text-gray-600 mb-4">{erroreCaricamento}</div>
                <button 
                  onClick={function() { window.location.reload(); }}
                  className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
                >
                  Riprova
                </button>
              </div>
            )}
            
            {!caricamento && !erroreCaricamento && (
              <>
                {/* Schermata di ricerca */}
                {step === 'ricerca' && (
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <div className="flex justify-between items-center mb-4">
                      <button
                        onClick={tornaDietro}
                        className="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm"
                      >
                        ‚Üê Indietro
                      </button>
                      <h2 className="text-xl font-bold text-center">Ricerca Percorsi</h2>
                      <div className="w-14"></div>
                    </div>
                    
                    <div className="mt-4 mb-6">
                      <div className="flex">
                        <input
                          type="text"
                          value={testoRicerca}
                          onChange={function(e) { setTestoRicerca(e.target.value); }}
                          placeholder="Cerca percorsi o vie..."
                          className="flex-grow p-2 border border-gray-300 rounded-l-lg focus:outline-none focus:ring-2 focus:ring-blue-600"
                        />
                        <button 
                          className="bg-blue-600 text-white px-4 py-2 rounded-r-lg hover:bg-blue-700"
                          onClick={function() { setTestoRicerca(testoRicerca); }}
                        >
                          Cerca
                        </button>
                      </div>
                    </div>
                    
                    <div className="mt-6">
                      <h3 className="text-lg font-semibold mb-3">Risultati della ricerca:</h3>
                      <div className="space-y-4">
                        {cercaPercorsi().length > 0 ? (
                          cercaPercorsi().map(function(percorso) {
                            return (
                              <button
                                key={percorso.id}
                                onClick={function() {
                                  setPercorsoSelezionato(percorso);
                                  setViaCorrente(0);
                                  setStep('vie');
                                }}
                                className="w-full bg-gray-50 hover:bg-gray-100 p-4 rounded-lg text-left border border-gray-200 transition-colors"
                              >
                                <span className="text-lg font-medium">{percorso.nome}</span>
                                <div className="text-sm text-gray-500 mt-1">
                                  Categoria: {percorso.categoria} ‚Ä¢ {percorso.vie.length} vie
                                </div>
                              </button>
                            );
                          })
                        ) : (
                          testoRicerca.trim() ? (
                            <div className="text-center text-gray-500 py-8">
                              Nessun risultato trovato per "{testoRicerca}"
                            </div>
                          ) : (
                            <div className="text-center text-gray-500 py-8">
                              Inserisci una parola chiave per cercare
                            </div>
                          )
                        )}
                      </div>
                    </div>
                  </div>
                )}
                
                {/* Schermata di selezione categoria */}
                {step === 'categorie' && (
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <h2 className="text-xl font-bold mb-4 text-center">Seleziona la categoria di partenza</h2>
                    <div className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
                      {categorie.map(function(categoria) {
                        return (
                          <button
                            key={categoria}
                            onClick={function() { selezionaCategoria(categoria); }}
                            className="bg-blue-100 hover:bg-blue-200 p-6 rounded-lg flex flex-col items-center justify-center transition-colors text-center"
                          >
                            <span className="text-lg font-semibold text-blue-800">{categoria}</span>
                          </button>
                        );
                      })}
                    </div>
                  </div>
                )}
        
                {/* Schermata di selezione percorso */}
                {step === 'percorsi' && categoriaSelezionata && (
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <div className="flex justify-between items-center mb-4">
                      <button
                        onClick={tornaDietro}
                        className="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm"
                      >
                        ‚Üê Indietro
                      </button>
                      <h2 className="text-xl font-bold text-center">Percorsi da {categoriaSelezionata}</h2>
                      <div className="w-14"></div> {/* Spazio vuoto per allineare il titolo */}
                    </div>
                    
                    <div className="space-y-4 mt-6">
                      {percorsiDB[categoriaSelezionata]?.map(function(percorso) {
                        return (
                          <button
                            key={percorso.id}
                            onClick={function() { selezionaPercorso(percorso); }}
                            className="w-full bg-gray-50 hover:bg-gray-100 p-4 rounded-lg text-left border border-gray-200 transition-colors"
                          >
                            <span className="text-lg font-medium">{percorso.nome}</span>
                            <div className="text-sm text-gray-500 mt-1">
                              {percorso.vie.length} vie nel percorso
                            </div>
                          </button>
                        );
                      })}
                    </div>
                  </div>
                )}
        
                {/* Schermata di visualizzazione vie */}
                {step === 'vie' && percorsoSelezionato && (
                  <div className="bg-white rounded-lg shadow-md p-6">
                    <div className="flex justify-between items-center mb-4">
                      <button
                        onClick={tornaDietro}
                        className="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm"
                      >
                        ‚Üê Indietro
                      </button>
                      <h2 className="text-lg font-bold text-center">{percorsoSelezionato.nome}</h2>
                      <div className="w-14 text-sm text-gray-500 text-right">
                        {viaCorrente + 1}/{percorsoSelezionato.vie.length}
                      </div>
                    </div>
                    
                    <div className="flex flex-col items-center justify-center bg-gray-50 rounded-lg p-8 my-6 min-h-64">
                      <div className="text-sm text-gray-500 mb-1">
                        Tappa {viaCorrente + 1}:
                      </div>
                      <div className="text-2xl font-bold text-center">
                        {percorsoSelezionato.vie[viaCorrente]}
                      </div>
                    </div>
                    
                    <div className="flex justify-between mt-6">
                      <button
                        onClick={mostraViaPrecedente}
                        className={`px-4 py-2 rounded ${
                          viaCorrente > 0
                            ? 'bg-gray-200 hover:bg-gray-300'
                            : 'bg-gray-100 text-gray-400 cursor-not-allowed'
                        }`}
                        disabled={viaCorrente === 0}
                      >
                        ‚Üê Precedente
                      </button>
                      
                      <div className="text-sm text-gray-500 self-center">
                        {viaCorrente + 1} di {percorsoSelezionato.vie.length}
                      </div>
                      
                      <button
                        onClick={mostraViaSuccessiva}
                        className={`px-4 py-2 rounded ${
                          viaCorrente < percorsoSelezionato.vie.length - 1
                            ? 'bg-blue-600 hover:bg-blue-700 text-white'
                            : 'bg-blue-300 text-white cursor-not-allowed'
                        }`}
                        disabled={viaCorrente === percorsoSelezionato.vie.length - 1}
                      >
                        Successiva ‚Üí
                      </button>
                    </div>
                  </div>
                )}
              </>
            )}
          </main>
          
          <footer className="bg-gray-200 p-4 text-center text-gray-600 text-sm">
            ¬© 2025 Percorsi Milano - {!caricamento && !erroreCaricamento && `${contaPercorsiTotali()} percorsi disponibili`}
          </footer>
        </div>
      );
    }
    
    // Rendering dell'app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
